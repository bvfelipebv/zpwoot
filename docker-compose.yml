version: '3.8'

services:
  # PostgreSQL Database
  postgres:
    image: postgres:16-alpine
    container_name: zpmeow-postgres
    restart: unless-stopped
    environment:
      POSTGRES_DB: zpmeow
      POSTGRES_USER: zpmeow
      POSTGRES_PASSWORD: zpmeow_password_change_in_production
      POSTGRES_INITDB_ARGS: "--encoding=UTF8 --locale=C"
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init-db.sql:/docker-entrypoint-initdb.d/init-db.sql
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U zpmeow -d zpmeow"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - zpmeow-network

  # zpmeow API (opcional - descomente para rodar a API no Docker)
  # api:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #   container_name: zpmeow-api
  #   restart: unless-stopped
  #   ports:
  #     - "8080:8080"
  #   environment:
  #     PORT: 8080
  #     ENVIRONMENT: production
  #     DATABASE_DRIVER: postgres
  #     DATABASE_URL: postgres://zpmeow:zpmeow_password_change_in_production@postgres:5432/zpmeow?sslmode=disable
  #     API_KEY: ${API_KEY:-your-secret-api-key-here}
  #     LOG_LEVEL: info
  #     WHATSAPP_DATA_DIR: /app/data
  #     MAX_SESSIONS: 10
  #     CONNECTION_TIMEOUT: 30
  #     PAIRING_TIMEOUT: 120
  #     AUTO_RESTORE_SESSIONS: true
  #   volumes:
  #     - whatsapp_data:/app/data
  #   depends_on:
  #     postgres:
  #       condition: service_healthy
  #   networks:
  #     - zpmeow-network

  # pgAdmin (opcional - interface web para gerenciar PostgreSQL)
  pgadmin:
    image: dpage/pgadmin4:latest
    container_name: zpmeow-pgadmin
    restart: unless-stopped
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@zpmeow.local
      PGADMIN_DEFAULT_PASSWORD: admin
      PGADMIN_CONFIG_SERVER_MODE: 'False'
    ports:
      - "5050:80"
    volumes:
      - pgadmin_data:/var/lib/pgadmin
    depends_on:
      - postgres
    networks:
      - zpmeow-network

volumes:
  postgres_data:
    driver: local
  pgadmin_data:
    driver: local
  # whatsapp_data:
  #   driver: local

networks:
  zpmeow-network:
    driver: bridge

